/*! mobile-select-area  v1.0.0
* author:tianxiangbing email:55342775@qq.com
* demo:http://www.lovewebgames.com/jsmodule/mobile-photo-preview.html 
* git:https://github.com/tianxiangbing/mobile-photo-preview  2015-04-03 */
function MobilePhotoPreview(){var a=Math.random().toString().replace(".","");this.id="mp_"+a,this.currentIndex=1,this.sum=1,this.arr=[],this.objArr={},this.dialog}MobilePhotoPreview.prototype={init:function(a){this.settings=$.extend({},a),this.target=$(this.settings.target),this.trigger=this.settings.trigger,this.bindEvent()},touch:function(a,b,c){function d(a){return c.call(this,a)}var e;"function"==typeof b&&(c=b),$(a).on("touchmove",b,function(){e=!0}).on("touchend",b,function(a){if(a.preventDefault(),!e){var b=c.call(this,a,"touch");b===!1&&(a.preventDefault(),a.stopPropagation())}e=!1}),$(a).on("click",b,d)},bindEvent:function(){var a=this;a.touch(a.target,a.trigger,function(){return a.initDailog.call(a,this),!1})},bindSlide:function(){var a=this,b={},c=0,d={};a.imgPreview.on("touchstart",function(a){b={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY},c=a.changedTouches[0].pageX}),a.imgPreview.on("touchmove",function(a){d={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY};var c=$(this).position();return $(this).css({left:c.left+(d.x-b.x),top:c.top+(d.y-b.y)}),b=d,!1}),a.imgPreview.on("touchend",function(e){d={x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY};var f=$(this).position(),g={left:f.left+(d.x-b.x),top:f.top+(d.y-b.y)};$(this).css(g);var h=Math.abs(g.left/a.maxWidth),i=h.toString().split("."),j=0,k=i.length>1?"0."+i[1]:0;j=k>.3?Math.ceil(h):Math.floor(h),console.log(j),a.currentIndex=j,c<d.x&&a.currentIndex--,a.currentIndex<0&&(a.currentIndex=0),a.currentIndex>=a.arr.length&&(a.currentIndex=a.arr.length-1),a.go()})},go:function(a){var b=this,c=b.currentIndex*b.maxWidth;a=a?"css":"animate",$(b.imgPreview)[a]({left:-c,top:0},500);var d=b.dialog.dialogContainer;$(".imgViewTop",d).html(b.currentIndex+1+"/"+b.arr.length),b.settings.callback&&b.settings.callback.call(b,b.objArr[b.currentIndex],b.currentIndex)},initDailog:function(a){var b=this;b.dialog=null,b.dialog=new Dialog,b.arr=b.target.find(b.trigger),b.sum=b.arr.length,b.currentIndex=$(a).index();var c=$.extend({target:'<div class="imgViewTop">'+(b.currentIndex+1)+"/"+b.sum+'</div><div class="pos-relative"><div id="imgPreview"></div></div><div id="imgTitle"></div>',animate:!0,show:!0,width:"100%",height:"100%",mask:!0,className:"ui-preview",afterHide:function(){this.dispose()},beforeShow:function(a){b.imgPreview=$("#imgPreview",a),b.format(a),b.bindSlide(),b.go(!0),b.settings.show&&b.settings.show(b.dialog.dialogContainer)}},{});b.dialog.init(c)},format:function(){function a(a){length++,b.objArr[a]={src:this.src,height:this.height,width:this.width,elem:$(b.imgPreview.children().get(a)).children("img"),index:a},b.objArr.length=length,b.initSize(a)}var b=this;this.length=0;for(var c="",d=0,e=b.arr.length;e>d;d++){var f=$(b.arr[d]),g='style="visibility:hidden;"';d==b.currentIndex&&(g='style="display:block;"'),c+="<div "+g+'><img src="'+f.attr("href")+'"/></div>',function(b,c){setTimeout(function(){var d=new Image;d.src=b.attr("href"),d.complete?a.call(d,c):d.onreadystatechange=function(){"complete"==this.readystate&&a.call(this,c)}})}(f,d)}b.imgPreview.html(c),setTimeout(function(){b.imgPreview.children().css("visibility","visible")},500),b.setSize(),$(window).resize($.proxy(b.setSize,b))},setSize:function(){var a=this,b=a.dialog.dialogContainer,c=Math.min(document.documentElement.clientHeight,document.body.clientHeight),d=Math.min(document.documentElement.clientWidth,document.body.clientWidth);this.maxHeight=c-$(".imgViewTop",b).height()-$(".imgTitle",b).height(),this.maxWidth=d,a.imgPreview.width(this.maxWidth*a.arr.length),a.imgPreview.height(this.maxHeight),a.imgPreview.children("div").width(this.maxWidth)},initSize:function(a){var b=this.objArr[a];if(this.maxHeight<b.height){b.elem.height(this.maxHeight);var c=this.maxHeight*b.width/b.height;b.elem.width(c),b.height=this.maxHeight,b.width=c}if(this.maxWidth<b.width){b.elem.width(this.maxWidth);var d=this.maxWidth*b.height/b.width;b.elem.width(c),b.height=d,b.width=this.maxWidth}var e=(this.maxHeight-b.height)/2,f=(this.maxWidth-b.width)/2;b.elem.css({top:e,left:f})}};